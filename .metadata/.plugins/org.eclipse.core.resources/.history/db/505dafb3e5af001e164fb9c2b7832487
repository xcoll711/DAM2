package u3e05AD;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

public class ActualitzacioBaseDades {

    // Canvia aquestes variables segons la teva configuració de la base de dades
    private static final String URL = "jdbc:mysql://localhost:3306/la_teva_base_de_dades";
    private static final String USUARI = "el_teu_usuari";
    private static final String CONTRASENYA = "la_teva_contrasenya";

    public static void main(String[] args) {
        // Inicialitza la connexió, l'statement i el resultSet
        try (Connection conn = DriverManager.getConnection(URL, USUARI, CONTRASENYA);
             Statement stmt = conn.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_UPDATABLE)) {

            // Inicia la transacció
            conn.setAutoCommit(false);

            // Troba l'últim client i actualitza el seu nom a "NomActualitzat"
            ResultSet resultSet = stmt.executeQuery("SELECT * FROM clientes");
            resultSet.last();
            resultSet.updateString("APELLIDOS", "NomActualitzat");
            resultSet.updateRow();

            // Elimina el registre del penúltim client
            resultSet.previous();
            resultSet.deleteRow();

            // Afegeix un nou client amb el nom "NouClient"
            resultSet.moveToInsertRow();
            resultSet.updateString("APELLIDOS", "NouClient");
            resultSet.insertRow();

            // Confirma la transacció si tot és exitós
            conn.commit();

        } catch (SQLException e) {
            // En cas d'error, fa un rollback per revertir els canvis
            System.err.println("Error a la base de dades. Realitzant rollback.");
            e.printStackTrace();
            try {
                if (conn != null) {
                    conn.rollback();
                }
            } catch (SQLException rollbackException) {
                rollbackException.printStackTrace();
            }
        }
    }
}
