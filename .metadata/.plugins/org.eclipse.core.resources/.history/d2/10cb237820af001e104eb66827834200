package u4e02;

import java.io.BufferedInputStream;
import java.io.FileInputStream;
import java.io.IOException;

import javax.swing.JFileChooser;

import org.apache.commons.net.ftp.FTP;
import org.apache.commons.net.ftp.FTPClient;
import org.apache.commons.net.ftp.FTPFile;

public class Test {
    public static void main(String[] args) {
        FTPClient cliente = new FTPClient();

        String servidor = "localhost";
        String user = "usuario1";
        String pasw = "1234";

        JFileChooser fc = new JFileChooser();

        int returnVal = fc.showOpenDialog(fc);
        if (returnVal == JFileChooser.APPROVE_OPTION) {
            System.out.println("You chose to open this file: " + fc.getSelectedFile().getName());

            try {
                System.out.println("Conectandose a " + servidor);
                cliente.connect(servidor);

                if (cliente.isConnected()) {
                    boolean login = cliente.login(user, pasw);

                    if (login) {
                        System.out.println("Login correcto");

                        String direc = "/NUEVODIREC";

                        if (!cliente.changeWorkingDirectory(direc)) {
                            String directorio = "NUEVODIREC";

                            if (cliente.makeDirectory(directorio)) {
                                System.out.println("Directorio: " + directorio + " creado...");
                                cliente.changeWorkingDirectory(directorio);
                            } else {
                                System.out.println("No se ha podido crear el Directorio");
                                System.exit(0);
                            }
                        }

                        System.out.println("Directorio actual: " + cliente.printWorkingDirectory());

                        String archivo = "C:\\FTP\\EJEMPLO.pdf";
                        BufferedInputStream in = new BufferedInputStream(new FileInputStream(archivo));

                        if (cliente.storeFile("prueba.pdf", in))
                            System.out.println("Subido correctamente...");
                        else
                            System.out.println("No se ha podido subir el fichero...");

                        in.close(); // Cerrar flujo
                        cliente.logout();
                    } else {
                        System.out.println("Login incorrecto");
                    }
                }
            } catch (IOException ioe) {
                ioe.printStackTrace();
            } finally {
                try {
                    if (cliente.isConnected()) {
                        cliente.disconnect();
                        System.out.println("Desconectado del servidor FTP");
                    }
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        } else {
            System.out.println("No se ha seleccionado ning√∫n archivo.");
        }
        
        try {
            cliente.enterLocalPassiveMode(); //modo pasivo

    		
    		System.out.println("Directorio actual: "
    				         + cliente.printWorkingDirectory());

    		FTPFile[] files = cliente.listFiles();
    		System.out.println("Ficheros en el directorio actual:"
    					+ files.length);
                //array para visualizar el tipo de fichero
    		String tipos[] = {"Fichero", "Directorio","Enlace simb."};
    		
    		for (int i = 0; i < files.length; i++) {
    			System.out.println("\t" + files[i].getName() + " => "
    					+ tipos[files[i].getType()]);
    		}
    		boolean logout = cliente.logout();
    		if (logout) 
    			System.out.println("Logout del servidor FTP...");
                    else 
    		        System.out.println("Error al hacer Logout...");
    		//
    		cliente.disconnect();
    		System.out.println("Desconectado...");
    	} catch (IOException ioe) {
    		ioe.printStackTrace();
    	}		
    }
}
