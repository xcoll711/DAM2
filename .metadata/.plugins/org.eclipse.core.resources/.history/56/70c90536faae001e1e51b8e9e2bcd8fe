/*
Crea una funció emmagatzemada amb MySQL 
(o amb Oracle o amb una altra base de dades) 
a la qual se li passi el DNI del client i que 
retorni els seus cognoms. Crea un programa en 
Java que faci una crida a aquesta funció utilitzant
JDBC i escrigui el valor retornat per la funció. 
Serà necessari consultar documentació o investigar 
com crear funcions emmagatzemades en la base de dades utilitzada,
 però es farà de manera molt semblant a un procediment emmagatzemat.
 */


package u3e04AD;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.CallableStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class JDBC_callable_statement {

    public static void main(String[] args) {

    	String urlConnection = "jdbc:mysql://localhost:3306/ad";
		String user = "root";
		String pwd = "";

		try (Connection c = DriverManager.getConnection(urlConnection, user, pwd);
             CallableStatement s = c.prepareCall("{call listado_clientes (?)}")) {

            s.setString(1, "78901234X");
            s.execute();

            ResultSet rs = s.getResultSet();
            int inout_long = s.getInt(2);

            System.out.println("=> inout_long: " + inout_long);

            int nCli = 0;
            while (rs.next()) {
                System.out.println("[" + (++nCli) + "]");
                System.out.println("DNI: " + rs.getString("DNI"));
                System.out.println("Apellidos: " + rs.getString("APELLIDOS"));
            }

        } catch (SQLException e) {
            muestraErrorSQL(e);
        } catch (Exception e) {
            e.printStackTrace(System.err);
        }
    }

    private static void muestraErrorSQL(SQLException e) {
        // Implementa el manejo de errores SQL según tus necesidades
        e.printStackTrace(System.err);
    }
}
