package u3e05AD;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

public class GestioClients {

	static String urlConnection = "jdbc:mysql://localhost:3306/ad";
	static String user = "root";
	static String pwd = "";

	public static void main(String[] args) {
		try {
			Connection c = DriverManager.getConnection(urlConnection, user, pwd);

			// Inicialitza la connexió, l'statement i el resultSet
			try (Statement stmt = c.createStatement(ResultSet.TYPE_SCROLL_SENSITIVE, ResultSet.CONCUR_UPDATABLE)) {

				// Inicia la transacció
				c.setAutoCommit(false);

				// Troba l'últim client i actualitza el seu nom a "NomActualitzat"
				ResultSet resultSet = stmt.executeQuery("SELECT * FROM clientes");
				resultSet.last();
				resultSet.updateString("APELLIDOS", "NomActualitzat");
				resultSet.updateRow();

				// Elimina el registre del penúltim client
				resultSet.previous();
				resultSet.deleteRow();

				// Afegeix un nou client amb el nom "NouClient"
				resultSet.moveToInsertRow();
				resultSet.updateString("APELLIDOS", "NouClient");
				resultSet.insertRow();

				// Confirma la transacció si tot és exitós
				c.commit();

			} catch (SQLException e) {
			/*	// En cas d'error, fa un rollback per revertir els canvis
				System.err.println("Error a la base de dades. Realitzant rollback.");
				e.printStackTrace();
				try {
					if (c != null) {
						c.rollback();
					}
				} catch (SQLException rollbackException) {
					rollbackException.printStackTrace();
				}
			*/
			}
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}
}
